<!doctype html>

<title>PencilScript</title>
<meta charset="utf-8"/>

<script src="lib/pencilscript.js"></script>

<script type="text/x-pencilscript" id="gamegrid">
var ps = PencilScript;
var style = {background: "#ccf", foreground: "#34c"};

var unit = 20;

var grid = ps.grid({
  open: true,
  width: 6 * unit,
  height: 5 * unit,
  strokeWidth: 1,
  stroke: "black",
  unit: unit,
  left: 0,
  top: 0
});

var player = ps.rect({
  width: .8 * unit,
  height: 1.5 * unit,
  fill: "#404040",
  left: grid.left + 2.725 * unit,
  top: grid.top + 1.825 * unit
});

var color = ps.rect({
  behind: grid,
  width: 2 * unit,
  height: 3 * unit,
  fill: style.background,
  left: grid.left + 2 * unit,
  top: grid.top + unit
});
</script>

<script type="text/x-pencilscript" id="smoothline">
var line = PencilScript.curvedArrow({
  startX: 0, startY: 0, startDir: 1,
  endX: 100, endY: 100, endDir: 1,
  stroke: "black",
  strokeWidth: 2
});
</script>

<textarea style="width: 100%; height: 300px; border: 1px solid #aa4">
</textarea>
<select></select> <button onclick="render()">Render</button><br>

<script>
  var te = document.querySelector("textarea");
  te.addEventListener("keyup", function(e) {
    if (e.keyCode == 13 && e.ctrlKey) {
      render();
      e.preventDefault();
    }
  });

  function render() {
    var exist = document.querySelector("svg");
    if (exist) exist.parentNode.removeChild(exist);
    document.body.appendChild(PencilScript.picture(new Function(te.value)));
  }

  var scripts = document.querySelectorAll("script");
  var sel = document.querySelector("select");
  for (var i = 0; i < scripts.length; i++) {
    var script = scripts[i];
    if (script.id && script.type == "text/x-pencilscript") {
      var code = script.innerText.trimLeft();
      var opt = sel.appendChild(document.createElement("option"));
      opt.value = code;
      opt.appendChild(document.createTextNode(script.id));
    }
  }
  sel.selectedIndex = sel.childNodes.length - 1;
  te.value = sel.value;
  sel.addEventListener("change", function() {
    te.value = sel.value;
  });
  render();
</script>
